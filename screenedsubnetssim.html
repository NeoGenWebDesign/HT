<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screened Subnet (DMZ) Simulator</title>
    <!-- Load Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background: linear-gradient(180deg, #353636 50%, #032a36 75%);
            min-height: 100vh;
            padding: 20px;
        }
        a {
            display: block;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            text-align: center;
        }
        .container-card {
            background-color: rgb(151, 150, 150);
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            max-width: 1200px;
            margin: auto;
        }
        .network-zone {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
            min-height: 100px;
            position: relative;
            flex: 1;
            margin: 0 10px;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.1);
        }
        .internet-zone { background-color: #ffe4e6; border: 2px solid #ef4444; } /* Red for External/Untrusted */
        .dmz-zone { background-color: #ffedd5; border: 2px dashed #f97316; } /* Orange for Neutral/Public Services */
        .internal-zone { background-color: #dcfce7; border: 2px solid #10b981; } /* Green for Internal/Trusted */

        .device, .firewall {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 10px 0;
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        .firewall {
            background-color: #3b82f6; /* Blue */
            color: white;
            font-size: 0.9rem;
            transform: rotate(90deg);
        }
        .server-web { background-color: #fcd34d; color: #1f2937; } /* Yellow for Web Server */
        .server-db { background-color: #93c5fd; color: #1f2937; } /* Light Blue for DB Server */
        .client-int { background-color: #10b981; color: white; } /* Green for Client */
        .client-ext { background-color: #ef4444; color: white; } /* Red for Client */

        .traffic-line {
            position: absolute;
            height: 4px;
            background-color: #9ca3af;
            z-index: 1;
            transition: all 0.5s ease;
        }

        /* Traffic animation styles */
        .traffic {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            opacity: 0;
            z-index: 20;
            transition: transform 1.5s ease-out, opacity 0.5s;
        }
        .traffic-http { background-color: #f97316; } /* Orange/Web */
        .traffic-internal { background-color: #10b981; } /* Green/Internal */
        .traffic-external { background-color: #ef4444; } /* Red/External */

        .log-box {
            min-height: 120px;
            background-color: #1f2937;
            color: #e5e7eb;
            font-family: 'Consolas', 'Courier New', monospace;
            border-radius: 0.75rem;
            padding: 1rem;
            overflow-y: auto;
            font-size: 0.85rem;
        }
        .log-info { color: #60a5fa; }
        .log-success { color: #34d399; }
        .log-denied { color: #f87171; }
        .log-drop { color: #facc15; }
    </style>
</head>
<body class="min-h-screen">

    <div class="container-card">
        <h1 class="text-3xl font-extrabold text-orange-500 mb-2 text-center">
            Screened Subnet (DMZ) Architecture Simulator
        </h1>
        <p class="text-center text-white mb-8 max-w-4xl mx-auto">
            This architecture uses two Firewalls (F-Ext and F-Int) to isolate public-facing services (DMZ) from the private network (Internal). Click a traffic scenario to see the data flow and how the firewalls enforce security policies.
        </p>
        <p class="text-sm text-yellow-500 mb-8 text-center">
            Press F5 or Reload/Refresh Browser to Reset Simulation.
        </p>
        <a id="link" class="text-sm hover:text-lime-500 text-yellow-200 mb-8 text-center" href="index.html">
            Back to Simulations Index
        </a>

        <!-- Visualization Area -->
        <div class="flex items-stretch justify-center h-96 space-x-2 relative">
            
            <!-- Internet Zone -->
            <div id="internet-zone" class="network-zone internet-zone">
                <span class="text-2xl font-bold text-red-700">Internet (Untrusted)</span>
                <div class="client-ext device mt-4">External Client</div>
            </div>

            <!-- Firewall 1 (External) -->
            <div id="fw-ext" class="firewall transform rotate-90 my-auto p-4 text-center">
                Firewall-External (F-Ext)
            </div>

            <!-- DMZ Zone (Screened Subnet) -->
            <div id="dmz-zone" class="network-zone dmz-zone">
                <span class="text-2xl font-bold text-orange-700">DMZ / Screened Subnet</span>
                <div class="server-web device mt-4">Web Server (TCP/80, 443)</div>
                <div class="text-sm mt-2 text-orange-600">The buffer zone for public services.</div>
            </div>

            <!-- Firewall 2 (Internal) -->
            <div id="fw-int" class="firewall transform rotate-90 my-auto p-4 text-center">
                Firewall-Internal (F-Int)
            </div>

            <!-- Internal Zone -->
            <div id="internal-zone" class="network-zone internal-zone">
                <span class="text-2xl font-bold text-green-700">Internal Network (Trusted)</span>
                <div class="server-db device mt-4">Database Server (TCP/1433)</div>
                <div class="client-int device">Internal Client</div>
            </div>
            
            <!-- Traffic Indicators (Dynamically positioned) -->
            <div id="traffic-indicator-1" class="traffic"></div>
            <div id="traffic-indicator-2" class="traffic"></div>
        </div>
        


        <!-- Controls and Policy Explanation -->
        <h3 class="text-xl font-semibold text-gray-800 mt-8 mb-4">Traffic Scenarios & Firewall Policy</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <button onclick="simulateTraffic('WEB')"
                    class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 text-base">
                1. External Web Access (HTTP/S)
            </button>
            <button onclick="simulateTraffic('INTERNAL')"
                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 text-base">
                2. Internal Client Access
            </button>
            <button onclick="simulateTraffic('INTRUSION_ATTEMPT')"
                    class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 text-base">
                3. Direct Internal Attack Attempt
            </button>
        </div>

        <h3 class="text-xl font-semibold text-gray-800 mb-3">Simulation Log</h3>
        <div id="sim-log" class="log-box">
            <p class="log-info">// Click a scenario above to start the traffic simulation.</p>
            <p class="log-info">// Firewall Policies:</p>
            <p class="log-info">// F-Ext (Internet $\rightarrow$ DMZ): Allows only 80, 443 (Web) to Web Server.</p>
            <p class="log-info">// F-Int (DMZ $\rightarrow$ Internal): Allows only 1433 (DB) from Web Server to DB Server.</p>
            <p class="log-info">// F-Int (Internet $\rightarrow$ Internal): DENIED for all traffic. Default DROP.</p>
        </div>
    </div>

    <script>
        const elements = {
            log: document.getElementById('sim-log'),
            fwExt: document.getElementById('fw-ext'),
            fwInt: document.getElementById('fw-int'),
            traffic1: document.getElementById('traffic-indicator-1'),
            traffic2: document.getElementById('traffic-indicator-2'),
            externalClient: document.querySelector('.client-ext'),
            webServer: document.querySelector('.server-web'),
            dbServer: document.querySelector('.server-db'),
            internalClient: document.querySelector('.client-int'),
        };

        const ZONE_POSITIONS = {
            'EXTERNAL': elements.externalClient,
            'WEB_SERVER': elements.webServer,
            'DB_SERVER': elements.dbServer,
            'INTERNAL_CLIENT': elements.internalClient
        };

        let isAnimating = false;

        // --- Utility Functions ---

        function log(message, type = 'log-info') {
            const now = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit', millisecond: '3-digit' });
            elements.log.innerHTML += `[${now}] <span class="${type}">${message}</span>\n`;
            elements.log.scrollTop = elements.log.scrollHeight;
        }

        function getPosition(element) {
            const rect = element.getBoundingClientRect();
            const containerRect = document.querySelector('.container-card').getBoundingClientRect();
            return {
                x: rect.left + rect.width / 2 - containerRect.left,
                y: rect.top + rect.height / 2 - containerRect.top
            };
        }

        // --- Animation Logic ---

        function animateTraffic(trafficElement, startKey, endKey, type, logMsg, success = true, duration = 1500) {
            return new Promise(resolve => {
                const startPos = getPosition(ZONE_POSITIONS[startKey]);
                const endPos = getPosition(ZONE_POSITIONS[endKey]);

                trafficElement.className = `traffic traffic-${type.toLowerCase()}`;
                
                // Set initial position
                trafficElement.style.left = `${startPos.x}px`;
                trafficElement.style.top = `${startPos.y}px`;
                trafficElement.style.opacity = '1';
                trafficElement.style.transition = `transform ${duration}ms linear, opacity 0.5s`;
                
                // Start animation
                setTimeout(() => {
                    trafficElement.style.transform = `translate(${endPos.x - startPos.x}px, ${endPos.y - startPos.y}px)`;
                }, 50);

                setTimeout(() => {
                    trafficElement.style.opacity = '0';
                    trafficElement.style.transform = 'none'; // Reset transform
                    log(logMsg, success ? 'log-success' : 'log-denied');
                    resolve();
                }, duration);
            });
        }

        // Simulates the firewall check and passage/denial
        function firewallCheck(fwElement, startKey, endKey, protocol, action) {
            return new Promise(resolve => {
                const startPos = getPosition(ZONE_POSITIONS[startKey]);
                const endPos = getPosition(ZONE_POSITIONS[endKey]);
                
                // Briefly flash the firewall to show it's active
                fwElement.style.transform = 'rotate(90deg) scale(1.1)';
                setTimeout(() => {
                    fwElement.style.transform = 'rotate(90deg) scale(1.0)';
                }, 300);

                // Log the action
                if (action === 'ALLOW') {
                    log(`[${fwElement.textContent.trim()}] Check: ${startKey} $\\rightarrow$ ${endKey} (${protocol}). Action: ALLOWED.`, 'log-success');
                    resolve(true);
                } else {
                    log(`[${fwElement.textContent.trim()}] Check: ${startKey} $\\rightarrow$ ${endKey} (${protocol}). Action: DENIED/DROPPED.`, 'log-drop');
                    resolve(false);
                }
            });
        }

        // --- Scenarios ---

        async function simulateTraffic(scenario) {
            if (isAnimating) {
                log("// Please wait for the current simulation to finish.", 'log-drop');
                return;
            }
            isAnimating = true;
            elements.log.innerHTML = '';
            log(`// Starting Scenario: ${scenario}`, 'log-info');

            switch (scenario) {
                
                case 'WEB':
                    log("External Client $\\rightarrow$ Web Server (HTTP/443)", 'log-info');
                    
                    // 1. External Client to F-Ext
                    await animateTraffic(elements.traffic1, 'EXTERNAL', 'WEB_SERVER', 'http', "Traffic reaches Firewall-External (F-Ext).", true, 800);
                    
                    // 2. F-Ext Check
                    let allowed1 = await firewallCheck(elements.fwExt, 'EXTERNAL', 'WEB_SERVER', 'TCP/443', 'ALLOW');
                    if (allowed1) {
                        // 3. F-Ext to Web Server
                        await animateTraffic(elements.traffic1, 'EXTERNAL', 'WEB_SERVER', 'http', "F-Ext $\\rightarrow$ DMZ. Connection established with Web Server.", true, 800);
                    }
                    
                    log("// RESULT: SUCCESS. F-Ext permits public web traffic to the DMZ's Web Server.", 'log-success');
                    break;
                
                case 'INTERNAL':
                    log("Web Server $\\rightarrow$ Database Server (DB/1433)", 'log-info');
                    
                    // 1. Web Server to F-Int (Internal traffic needed for data retrieval)
                    await animateTraffic(elements.traffic1, 'WEB_SERVER', 'DB_SERVER', 'internal', "Traffic reaches Firewall-Internal (F-Int).", true, 800);
                    
                    // 2. F-Int Check
                    let allowed2 = await firewallCheck(elements.fwInt, 'WEB_SERVER', 'DB_SERVER', 'TCP/1433', 'ALLOW');
                    if (allowed2) {
                        // 3. F-Int to DB Server
                        await animateTraffic(elements.traffic1, 'WEB_SERVER', 'DB_SERVER', 'internal', "F-Int $\\rightarrow$ Internal Network. Connection established with DB Server.", true, 800);
                    }
                    
                    log("// RESULT: SUCCESS. F-Int permits DB connection ONLY FROM the Web Server to the DB Server.", 'log-success');
                    break;

                case 'INTRUSION_ATTEMPT':
                    log("External Client $\\rightarrow$ Database Server (Intrusion Attempt on TCP/1433)", 'log-info');
                    
                    // 1. External Client to F-Ext
                    await animateTraffic(elements.traffic1, 'EXTERNAL', 'WEB_SERVER', 'external', "Traffic reaches Firewall-External (F-Ext). Protocol: TCP/1433.", true, 800);

                    // 2. F-Ext Check
                    let allowed3 = await firewallCheck(elements.fwExt, 'EXTERNAL', 'WEB_SERVER', 'TCP/1433', 'DENY');
                    if (!allowed3) {
                        // 3. F-Ext drops the packet
                        log("F-Ext DROPS the packet. TCP/1433 is not allowed to enter the DMZ.", 'log-drop');
                        // Fade out the dropped traffic indicator
                        elements.traffic1.style.opacity = '0'; 
                    } else {
                        // (Theoretical path if F-Ext fails) F-Ext to DMZ
                        await animateTraffic(elements.traffic1, 'EXTERNAL', 'WEB_SERVER', 'external', "F-Ext Passed (ERROR IN POLICY). Traffic reaches DMZ.", true, 800);
                        
                        // 4. Traffic attempts to cross F-Int
                        await animateTraffic(elements.traffic2, 'WEB_SERVER', 'DB_SERVER', 'external', "Traffic reaches Firewall-Internal (F-Int).", true, 800);

                        // 5. F-Int Check (This check should deny it, protecting the internal network)
                        let allowed4 = await firewallCheck(elements.fwInt, 'EXTERNAL', 'DB_SERVER', 'TCP/1433', 'DENY');
                        if (!allowed4) {
                            log("F-Int DROPS the packet. Direct unauthorized access to Internal Network is blocked.", 'log-drop');
                            elements.traffic2.style.opacity = '0'; 
                        }
                    }
                    
                    log("// RESULT: BLOCKED. The layers of defense (F-Ext and F-Int) prevent unauthorized access from the internet to the sensitive Internal Network.", 'log-success');
                    break;

                default:
                    log("// Unknown scenario.", 'log-drop');
                    break;
            }

            isAnimating = false;
        }

        // Initial setup to correctly position traffic indicators
        window.onload = () => {
             // Position traffic indicators off-screen initially
            elements.traffic1.style.top = `${getPosition(elements.externalClient).y}px`;
            elements.traffic1.style.left = `${getPosition(elements.externalClient).x}px`;
            
            elements.traffic2.style.top = `${getPosition(elements.webServer).y}px`;
            elements.traffic2.style.left = `${getPosition(elements.webServer).x}px`;
        };
    </script>
</body>
</html>