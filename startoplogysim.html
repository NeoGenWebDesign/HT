<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Network Topology Simulator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background: linear-gradient(180deg, #353636 50%, #032a36 75%);
            min-height: 100vh;
        }
        a {
            display: block;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            text-align: center;
        }
        .container-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
            padding: 2rem;
        }
        .vis-area {
            position: relative;
            height: 450px;
            width: 100%;
            border-radius: 0.75rem;
            background-color: #fff;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        .node {
            position: absolute;
            width: 65px;
            height: 65px;
            background-color: #1d4ed8; /* Blue for Nodes */
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s, transform 0.3s;
            z-index: 10;
            cursor: pointer;
        }
        .node:hover {
            transform: scale(1.05);
        }
        .switch {
            position: absolute;
            width: 90px;
            height: 90px;
            background-color: #059669; /* Emerald Green for Switch */
            color: white;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.6);
            border: 3px solid #10b981;
            z-index: 15;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .switch-fail {
            background-color: #dc2626 !important;
            border-color: #ef4444 !important;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.6) !important;
        }
        .link {
            position: absolute;
            background-color: #9ca3af; /* Gray link */
            height: 3px;
            transform-origin: 0 0;
            z-index: 5;
        }
        .packet {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #f97316; /* Orange for data */
            z-index: 20;
            transition: all linear;
            box-shadow: 0 0 8px #f97316;
        }
        .console-log {
            min-height: 200px;
            background-color: #1f2937;
            color: #d1d5db;
            font-family: 'Consolas', 'Courier New', monospace;
            border-radius: 0.5rem;
            padding: 1rem;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 0.85rem;
        }
        .log-send { color: #f97316; } /* Orange */
        .log-forward { color: #059669; } /* Green */
        .log-accept { color: #34d399; } /* Light Green */
        .log-fail { color: #ef4444; font-weight: bold; } /* Red */
        .log-info { color: #facc15; } /* Yellow */
    </style>
</head>
<body class="p-4 md:p-10 min-h-screen">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl font-extrabold text-orange-500 mb-2 text-center">
            Star Network Topology Simulation
        </h1>
        <p class="text-lg text-white mb-6 text-center">
            Simulating data forwarding via a central Switch.
        </p>
        <p class="text-sm text-yellow-500 mb-8 text-center">
            Press F5 or Reload/Refresh Browser to Reset Simulation.
        </p>
        <a id="link" class="text-sm hover:text-lime-500 text-yellow-200 mb-8 text-center" href="index.html">
            Back to Simulations Index
        </a>

        <div class="container-card">
            <p class="text-gray-700 mb-4 text-sm">
                [Image of Star Network Topology]
                In a Star Topology, every device (Node) has a **dedicated point-to-point link** to a central device, typically a **Switch** (or Hub). Data transmission always goes from **Source $\rightarrow$ Switch $\rightarrow$ Target**. This architecture is highly reliable because if one node fails, the rest of the network remains functional. However, if the central Switch fails, the entire network goes down.
            </p>
            
            <div id="star-vis" class="vis-area">
                <!-- Visualization elements will be injected here -->
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 items-end">
                <div class="bg-gray-100 p-3 rounded-lg flex flex-col justify-center">
                    <label class="text-sm font-medium text-gray-700 mb-1">Source Node:</label>
                    <select id="source-select" class="p-2 border border-gray-300 rounded-md"></select>
                </div>
                <div class="bg-gray-100 p-3 rounded-lg flex flex-col justify-center">
                    <label class="text-sm font-medium text-gray-700 mb-1">Target Node:</label>
                    <select id="target-select" class="p-2 border border-gray-300 rounded-md"></select>
                </div>
                
                <button onclick="simulateTransmission()" id="send-btn"
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 text-center text-sm disabled:opacity-50">
                    Start Transmission
                </button>
                <button onclick="toggleSwitchFailure()" id="fail-btn"
                        class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 text-center text-sm">
                    Simulate Switch Failure
                </button>
            </div>

            <h3 class="text-xl font-semibold text-gray-800 mb-3">Network Console Log</h3>
            <div id="star-log" class="console-log">
                <p class="log-info">Network is initialized. Select Source and Target nodes above, then click 'Start Transmission'.</p>
            </div>
        </div>
    </div>

    <script>
        const NODE_COUNT = 6;
        const NODE_IDS = Array.from({ length: NODE_COUNT }, (_, i) => String.fromCharCode(65 + i)); // A, B, C, D, E, F
        const DURATION_PER_LEG_MS = 1000;
        const SWITCH_POS = { x: 0, y: 0 }; // Will be calculated dynamically
        const RADIUS = 160;
        
        let animationLocked = false;
        let isSwitchFailed = false;
        let nodePositions = {}; // Stores calculated X, Y coordinates for each node

        // --- Utility Functions ---

        /** Logs a message to the console element */
        function log(message, type = 'log-info') {
            const consoleEl = document.getElementById('star-log');
            const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false, second: '2-digit', minute: '2-digit' });
            consoleEl.innerHTML += `[${timestamp}] <span class="${type}">${message}</span>\n`;
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }
        
        /** Creates the visual packet element */
        function createPacket(x, y, color) {
            const packet = document.createElement('div');
            packet.className = `packet`;
            packet.style.backgroundColor = color;
            packet.style.left = `${x - 7.5}px`; // Centered
            packet.style.top = `${y - 7.5}px`; // Centered
            return packet;
        }

        // --- Core Visualization Setup ---

        /** Clears the visualization container and calculates node positions */
        function initializeVisualization() {
            const container = document.getElementById('star-vis');
            container.innerHTML = '';
            
            const { width, height } = container.getBoundingClientRect();
            
            // 1. Calculate Switch Position (Center of the container)
            SWITCH_POS.x = width / 2;
            SWITCH_POS.y = height / 2;

            // 2. Draw the Switch
            const switchEl = document.createElement('div');
            switchEl.className = 'switch transition-all';
            switchEl.id = 'central-switch';
            switchEl.style.left = `${SWITCH_POS.x - 45}px`; // Centered
            switchEl.style.top = `${SWITCH_POS.y - 45}px`; // Centered
            switchEl.innerHTML = '<span class="text-lg">Switch</span><span class="text-xs">Central Hub</span>';
            container.appendChild(switchEl);
            
            // 3. Calculate and draw nodes & links
            const angleStep = (2 * Math.PI) / NODE_COUNT;
            
            NODE_IDS.forEach((id, index) => {
                const angle = index * angleStep - (Math.PI / 2); // Start at 12 o'clock
                
                // Calculate position on the circle
                const x = SWITCH_POS.x + RADIUS * Math.cos(angle);
                const y = SWITCH_POS.y + RADIUS * Math.sin(angle);
                
                nodePositions[id] = { x, y };
                
                // Draw Node
                const node = document.createElement('div');
                node.className = 'node';
                node.id = `node-${id}`;
                node.style.left = `${x - 32.5}px`; // Centered
                node.style.top = `${y - 32.5}px`; // Centered
                node.textContent = `Node ${id}`;
                node.onclick = () => selectNode(id);
                container.appendChild(node);
                
                // Draw Link (Line between node and switch)
                const link = document.createElement('div');
                link.className = 'link';
                
                const dx = x - SWITCH_POS.x;
                const dy = y - SWITCH_POS.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const rotation = Math.atan2(dy, dx);
                
                link.style.width = `${distance}px`;
                link.style.left = `${SWITCH_POS.x}px`;
                link.style.top = `${SWITCH_POS.y}px`;
                link.style.transform = `rotate(${rotation}rad)`;
                container.appendChild(link);
            });
            
            // Re-apply switch failure state if necessary
            updateSwitchState();

            populateSelects();
        }

        /** Populates the source and target dropdowns */
        function populateSelects() {
            const sourceSelect = document.getElementById('source-select');
            const targetSelect = document.getElementById('target-select');

            sourceSelect.innerHTML = '';
            targetSelect.innerHTML = '';

            NODE_IDS.forEach(id => {
                const sourceOption = new Option(`Node ${id}`, id);
                const targetOption = new Option(`Node ${id}`, id);
                sourceSelect.add(sourceOption);
                targetSelect.add(targetOption);
            });

            // Set default selections
            sourceSelect.value = 'A';
            targetSelect.value = 'D';
            updateSelectedNodes();
            
            // Add change listeners
            sourceSelect.onchange = updateSelectedNodes;
            targetSelect.onchange = updateSelectedNodes;
        }

        /** Updates the visual style of the selected nodes */
        function updateSelectedNodes() {
            const sourceId = document.getElementById('source-select').value;
            const targetId = document.getElementById('target-select').value;

            document.querySelectorAll('.node').forEach(node => {
                node.style.borderColor = 'transparent';
                node.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.3)';
            });

            const sourceEl = document.getElementById(`node-${sourceId}`);
            if (sourceEl) {
                sourceEl.style.borderColor = '#f97316'; // Orange
                sourceEl.style.boxShadow = '0 0 10px #f97316';
            }
            
            const targetEl = document.getElementById(`node-${targetId}`);
            if (targetEl) {
                targetEl.style.borderColor = '#059669'; // Green
                targetEl.style.boxShadow = '0 0 10px #059669';
            }
        }
        
        /** Allows clicking a node to set it as source */
        function selectNode(id) {
            const sourceSelect = document.getElementById('source-select');
            sourceSelect.value = id;
            updateSelectedNodes();
        }
        
        /** Updates the visual state of the switch based on failure status */
        function updateSwitchState() {
            const switchEl = document.getElementById('central-switch');
            const failBtn = document.getElementById('fail-btn');
            if (isSwitchFailed) {
                switchEl.classList.add('switch-fail');
                switchEl.innerHTML = '<span class="text-lg">FAILED</span><span class="text-xs">No Connectivity</span>';
                failBtn.textContent = 'Restore Switch';
                failBtn.classList.replace('bg-yellow-600', 'bg-green-600');
                failBtn.classList.replace('hover:bg-yellow-700', 'hover:bg-green-700');
            } else {
                switchEl.classList.remove('switch-fail');
                switchEl.innerHTML = '<span class="text-lg">Switch</span><span class="text-xs">Central Hub</span>';
                failBtn.textContent = 'Simulate Switch Failure';
                failBtn.classList.replace('bg-green-600', 'bg-yellow-600');
                failBtn.classList.replace('hover:bg-green-700', 'hover:bg-yellow-700');
            }
        }

        /** Toggles the switch failure state */
        function toggleSwitchFailure() {
            isSwitchFailed = !isSwitchFailed;
            updateSwitchState();
            if (isSwitchFailed) {
                log('CRITICAL ERROR: Central Switch has failed. All communication ceases.', 'log-fail');
            } else {
                log('Switch restored. Network functionality returned.', 'log-info');
            }
        }


        // --- Core Simulation Functions ---

        /** Simulates the data transmission process */
        async function simulateTransmission() {
            if (animationLocked) return;
            
            const sourceId = document.getElementById('source-select').value;
            const targetId = document.getElementById('target-select').value;
            
            if (sourceId === targetId) {
                log(`ERROR: Source and Target nodes must be different.`, 'log-fail');
                return;
            }
            if (isSwitchFailed) {
                 log(`ATTEMPT FAILED: Node ${sourceId} attempted to send, but the Central Switch is down. No transmission possible.`, 'log-fail');
                 return;
            }

            animationLocked = true;
            document.querySelectorAll('button').forEach(btn => btn.disabled = true);
            document.getElementById(`node-${sourceId}`).style.transform = 'scale(1.1)';
            
            log('-------------------------------------------', 'log-info');
            log(`START: Node ${sourceId} sends a frame intended for Node ${targetId}.`, 'log-send');

            const p = createPacket(nodePositions[sourceId].x, nodePositions[sourceId].y, '#f97316');
            document.getElementById('star-vis').appendChild(p);

            // 1. Packet travels from Source to Switch
            log(`Node ${sourceId} $\rightarrow$ Switch: Frame travels on the dedicated link.`, 'log-send');
            await movePacket(p, nodePositions[sourceId], SWITCH_POS, DURATION_PER_LEG_MS);

            // 2. Switch processes and forwards
            log(`Switch receives frame, consults MAC address table, and FORWARDS the frame only to the port connected to Node ${targetId}. (Unicast)`, 'log-forward');
            p.style.backgroundColor = '#059669'; // Change color to indicate forwarding

            // 3. Packet travels from Switch to Target
            log(`Switch $\rightarrow$ Node ${targetId}: Frame travels on the dedicated link.`, 'log-forward');
            await movePacket(p, SWITCH_POS, nodePositions[targetId], DURATION_PER_LEG_MS);

            // 4. Target accepts
            const targetEl = document.getElementById(`node-${targetId}`);
            targetEl.style.transform = 'scale(1.1)';
            targetEl.classList.add('ring-4', 'ring-green-400');
            log(`Node ${targetId} ACCEPTS the frame.`, 'log-accept');
            
            // 5. Cleanup and unlock
            setTimeout(() => {
                p.remove();
                document.getElementById(`node-${sourceId}`).style.transform = 'scale(1.0)';
                targetEl.style.transform = 'scale(1.0)';
                targetEl.classList.remove('ring-4', 'ring-green-400');
                
                log(`END: Transmission successful.`, 'log-info');
                animationLocked = false;
                document.querySelectorAll('button').forEach(btn => btn.disabled = false);
            }, 500);
        }

        /** Animates a packet from one point to another */
        function movePacket(element, startPos, endPos, duration) {
            return new Promise(resolve => {
                const dx = endPos.x - startPos.x;
                const dy = endPos.y - startPos.y;
                
                // Position adjustment for the packet element itself
                const offsetX = -7.5; 
                const offsetY = -7.5; 

                // Set initial position (using left/top)
                element.style.left = `${startPos.x + offsetX}px`;
                element.style.top = `${startPos.y + offsetY}px`;
                
                // Apply transition property for smooth movement
                element.style.transition = `transform ${duration}ms linear`;
                
                // Apply the transformation to move to the end position
                element.style.transform = `translate(${dx}px, ${dy}px)`;

                setTimeout(() => {
                    // Update the element's base position to the end position
                    element.style.left = `${endPos.x + offsetX}px`;
                    element.style.top = `${endPos.y + offsetY}px`;
                    element.style.transform = 'translate(0, 0)'; // Reset transform
                    element.style.transition = 'none'; // Clear transition for next move
                    resolve();
                }, duration);
            });
        }

        // --- Event Listeners and Initial Setup ---
        
        window.addEventListener('load', initializeVisualization);
        window.addEventListener('resize', initializeVisualization);
    </script>
</body>
</html>